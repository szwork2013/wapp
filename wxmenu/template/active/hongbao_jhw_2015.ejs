<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"></meta>
<meta content="no-cache" http-equiv="Pragma"></meta>
<meta content="no-cache" http-equiv="Cache-Control"></meta>
<meta content="0" http-equiv="Expires"></meta>
<link rel="stylesheet" href="http://wzzy2014skin.qiniudn.com/bootstrap/css/bootstrap.min.css">
<script src="http://piccvote.qiniudn.com/dist/js/vendor/jquery.min.js" type="text/javascript"></script>
<script src="http://wzhfile.qiniudn.com/jquery.cookie.js"  type="text/javascript"></script>
<script src="http://wzzy2014skin.qiniudn.com/bootstrap/js/bootstrap.min.js"></script>
<script src="http://wzhfile.qiniudn.com/moment.js" type="text/javascript"></script>
<link href="http://wzzy2014skin.qiniudn.com/szggl_2014/css/layout.css" rel="stylesheet" type="text/css" />
<title>锦红湾领红包</title>
<style type="text/css">
	.box{
		width: 100%;
		position: relative;
		top:0;
		left:0;
	}

	.bgimg{
		width: 100%;
		position: relative;
		height: 100%;
		display: block;
	}
	.totalMoney{
		width: 300px;
		text-align: center;
		position: absolute;
		top: 66%;
		left: 50%;
		margin-left: -150px;
		color: #f8ff00;
		font-size: 22px;
		z-index: 9;
		font-family: '微软雅黑';
	}

</style>
</head>
<body bgcolor="#4b0d00">

<div id="noHongBao" class="box" style="display:none">
	<img src="http://wkmixtown.qiniudn.com/jhw/hongbao_jhw_dbq.jpg" class="bgimg" />
</div>
<div id="HongBao1" class="box" style="display:none">
	<img src="http://wkmixtown.qiniudn.com/jhw/hongbao_jhw_gx.jpg" class="bgimg" />
</div>
<div id="HongBao2" class="box" style="display:none">
	<img src="http://wkmixtown.qiniudn.com/jhw/hongbao_jhw_je.jpg" class="bgimg" />
	<p id="totalMoney" class="totalMoney"></p>
</div>




<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
<script src="/api/xinyutang/jsconfig?url=<%= jsurl %>" type="text/javascript"></script>
<script type="text/javascript">

var logCount = <%= logCount %>
var appId = '<%= appId %>'
var appEname = '<%= appEname %>'
var isMyPage = <%= isMyPage %>;
var toUserId = '<%= toUserId %>'
var fromUserId = '<%= fromUserId %>'
var activeId = '<%= activeId %>'
var supportCount = <%= supportCount %>
var supportScore = <%= supportScore %>
var hasAdd = <%= hasAdd %>
var prizeList = <%- JSON.stringify(prizeList) %>
var myPrizeList = <%- JSON.stringify(myPrizeList) %>
var activeObj = <%- JSON.stringify(activeObj.activeObj) %>
var endTime = moment(new Date(activeObj.endTime))

window.isAjax = false


$(function(){

	//一进来就刷新ajax
	var getHongBao = function(){
		$.post('/api/'+appEname+'/getmoney',{
            replayEname:'hongbao_jhw_2015', 
            activeId:activeId,
        },function(d){
        	if(d.error == 1){
        		$('#noHongBao').show()
        	}
        	else{
        		if(d.data.hasGet == true){
        			$('#totalMoney').html('获得 '+d.data.val+' 元')
        			$('#HongBao2').show()
        		}
        		else{
        			$('#totalMoney').html('获得 '+d.data.val+' 元')
        			$('#HongBao1').show()
        		}
        		
        	}

        })

	}

	$('#HongBao1').click(function(){
		$('#noHongBao, #HongBao1').hide()
		$('#HongBao2').show()

	})

	getHongBao()


	
	//部署上生产环境，把alert去掉

	if(window.jsticket_error=='1'){
		//alert('微信jsdk config加载出错')
		//alert(window.jsconfig)
	}
	if(window.jsticket_error=='0'){
			$('#config').html(JSON.stringify(window.jsconfig))

			wx.config(window.jsconfig);
			wx.ready(function(){
				wx.hideOptionMenu();
			    // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
			  //  alert('wx jsdk ready')


			    wx.onMenuShareTimeline({
				    title: '过年到龙湖打卡领红包（第二波）', // 分享标题
				    link: 'http://mp.weixin.qq.com/s?__biz=MzA3NzE0MjgzNg==&mid=206128992&idx=1&sn=cd4c22c836d120c6f862e8f17084a5aa#rd', // 分享链接
				    imgUrl: 'http://bcs.duapp.com/xytimg/zhuli%2Flogo20150214.png', // 分享图标
				    trigger:function(){
				    	$('#action').append('<p>成功点击分享到朋友圈</p>')
				    },
				    complete:function(){
				    	$('#action').append('<p>完成分享到朋友圈</p>')
				    },
				    success: function () { 
				        // 用户确认分享后执行的回调函数
				        $('#action').append('<p>成功分享到朋友圈</p>')
				    },
				    cancel: function () { 
				        // 用户取消分享后执行的回调函数
				        $('#action').append('<p>用户取消分享到朋友圈</p>')
				    }
				});

				wx.onMenuShareAppMessage({
				    title: '过年到龙湖打卡领红包（第二波）', // 分享标题
				    desc: '全套APPLE洋财，大奖层层加码', // 分享描述
				    link: 'http://mp.weixin.qq.com/s?__biz=MzA3NzE0MjgzNg==&mid=206128992&idx=1&sn=cd4c22c836d120c6f862e8f17084a5aa#rd', // 分享链接
				    imgUrl: 'http://bcs.duapp.com/xytimg/zhuli%2Flogo20150214.png', // 分享图标
				    type: 'link', // 分享类型,music、video或link，不填默认为link
				    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
				    trigger:function(){
				    	$('#action').append('<p>成功点击发送给朋友</p>')
				    },
				    complete:function(){
				    	$('#action').append('<p>完成发送给朋友</p>')
				    },
				    success: function () { 
				        // 用户确认分享后执行的回调函数
				        $('#action').append('<p>成功发送给朋友</p>')
				    },
				    cancel: function () { 
				        // 用户取消分享后执行的回调函数
				        $('#action').append('<p>取消发送给朋友</p>')
				    }
				});



			    wx.checkJsApi({
				    jsApiList: ['chooseImage'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
				    success: function(res) {
				    //	alert(JSON.stringify(res))
				        // 以键值对的形式返回，可用的api值true，不可用为false
				        // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
				    }});

			});
			wx.error(function(res){

			    // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
			  //  alert('wx.error config出错')
			  //  alert(JSON.stringify(res))
			});

			

	}


})




</script> 


</body>
</html>





