<!DOCTYPE>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=0.67,maximum-scale=0.67,user-scalable=no;"/>
<meta name="apple-touch-fullscreen" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no">

<!--打开弹出输入框，只能抽1次，中奖奖品在弹出层体现-->

<title>大华锦绣华城精美礼品任你抽</title>
<link rel="stylesheet" href="http://wzzy2014skin.qiniudn.com/bootstrap/css/bootstrap.min.css">
<script src="http://wzzy2014skin.qiniudn.com/js/jquery.1.11.1.min.js" type="text/javascript"></script>
<script src="http://www.6998cdn.com/uc55_2014/js/jquery.cookie.js"  type="text/javascript"></script>
<script src="http://wzzy2014skin.qiniudn.com/bootstrap/js/bootstrap.min.js"></script>


<link href="http://bcs.duapp.com/xytimg/zp%2Factivity-style.css" rel="stylesheet" type="text/css">
<script src="http://wzhfile.qiniudn.com/moment.js" type="text/javascript"></script>


<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>



<%- newrelic.getBrowserTimingHeader() %>
</head>
<style type="text/css">


</style>
<body>
<div class="body_wrap">



</div>

<script type="text/javascript">





//遮照功能
var maskObj = $('#mask');
var mask = function () {        
        if(maskObj.is(':visible')){
            maskObj.hide();
        }
        else{
            maskObj.show();
        }
}
//遮照功能









window.isforward_today = moment().hour(23).minute(59).second(59)
window.isforward_today = new Date(window.isforward_today)


//var forwardingCallback = function(){
  //10表示cookie设置有效期10天
  //$.cookie('isForward', '1', { expires: 10, path: location.pathname });
  //location.href = location.href
//}





if($.cookie('isforward') == '1'){
  $.removeCookie('isforward');
  $.cookie('isforward', '1', { expires: window.isforward_today, path:location.pathname});
}
if($.cookie('has_modify_info') == '1'){
  $.removeCookie('has_modify_info');
   $.cookie('has_modify_info', '1', { expires: window.isforward_today, path: location.pathname });
}


//alert(window.isforward_today)
//$.cookie('isforward', '1', { expires: window.isforward_today, path: '/' });
//alert($.cookie('isforward'))







var lotteryid = '<%= lotteryObj._id %>'
var userid = '<%= userid%>'
var appId = '<%= appId%>'
var u_username = '<%= wxuobj.appUserName %>'
var u_mobile = '<%= wxuobj.appUserMobile %>'
var appUserName = u_username
var appUserMobile = u_mobile 

window.isAjaxing = false

$(function(){


  


  var getMyPrize = function(){

      if(user_v == '未认证会员'){
          $('#appUserName').val('');
      }
      if(mobile_v.length != 11){
          $('#appUserMobile').val('');
      }

      window.lotteryData = {};

       $.get('/lottery/<%= appEname%>/info?ename=<%= lotteryEname%>',{},function(d){
        if(d.error == 1){
          return alert(d.data)
        }
            window.lotteryData = d.data;
            work(d.data)
            doshare()

        },'json')

        var work = function(data){

               $('#modify_info').click(function(){
                  $('#myModal').modal({
                      backdrop:false
                    })
               })

               if((window.lotteryData.record.length<6 && $.cookie('has_modify_info') != '1') 
                ||
                ( u_username == '未认证会员' || u_mobile.length != 11)
                ){
                  $('#myModal').modal({
                      backdrop:false
                    })
               }

               
           //put my prize
             var tmp_s = ''
           
           

             window.myPrizeName = false
             if(data.record.length > 0){

              
             }
               $('#prize_list').html(tmp_s)
               //end pu prize
             


            
               }
  }



  $('.lottery_btn').click(function(){
          if(window.isAjaxing) return
          window.isAjaxing = true
           $.ajax({
              url: "/lottery/<%= appEname%>/start?ename=<%= lotteryEname%>",
              dataType: "json",
              type:'POST',
              data: {
                 lotteryId:lotteryid
              },
              beforeSend: function() {
               
              },
              success: function(d) {
                  window.isAjaxing = false
                  if(d.error == 1){
                     return alert(d.data)
                  }
                  if(d.data.prizeId == 0){
                    return alert('很遗憾没有中奖')
                  }
                  else{
                    return alert(d.data.name)
                  }
              },
              error: function() {
                  window.isAjaxing = false
                  alert('抽奖失败，请重试')
              },
              timeout: 5000
            })
  })

})

</script> 


<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
<script src="/api/xinyutang/jsconfig?url=<%= jsurl %>" type="text/javascript"></script>

<script>

  function doshare(){ 
    

    if(window.myPrizeName){
      //var titleStr = '我在大华锦绣华城抽到'+window.myPrizeName
      var titleStr = '大华锦绣华城精美好礼任你抽'
    }
    else{
      var titleStr = '大华锦绣华城精美好礼任你抽'
    }

    //部署上生产环境，把alert去掉
    if(window.jsticket_error=='1'){
      //alert('微信jsdk config加载出错')
      //alert(window.jsconfig)
    }
    if(window.jsticket_error=='0'){
        $('#config').html(JSON.stringify(window.jsconfig))

        wx.config(window.jsconfig);
        wx.ready(function(){

            // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
          //  alert('wx jsdk ready')


            wx.onMenuShareTimeline({
              title: titleStr, // 分享标题
              link: 'http://114.215.183.41/2015/dh2015/default.html', // 分享链接
              imgUrl: 'http://bcs.duapp.com/xytimg/zp%2Flogo0315.jpg', // 分享图标
              trigger:function(){
                $('#action').append('<p>成功点击分享到朋友圈</p>')
              },
              complete:function(){
                $('#action').append('<p>完成分享到朋友圈</p>')
              },
              success: function () { 
                  // 用户确认分享后执行的回调函数
                  $('#action').append('<p>成功分享到朋友圈</p>')
              },
              cancel: function () { 
                  // 用户取消分享后执行的回调函数
                  $('#action').append('<p>用户取消分享到朋友圈</p>')
              }
          });

          wx.onMenuShareAppMessage({
              title: titleStr, // 分享标题
              desc: '精美礼品大派送，更有机会活动iwatch哦', // 分享描述
              link: 'http://114.215.183.41/2015/dh2015/default.html', // 分享链接
              imgUrl: 'http://bcs.duapp.com/xytimg/zp%2Flogo0315.jpg', // 分享图标
              type: 'link', // 分享类型,music、video或link，不填默认为link
              dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
              trigger:function(){
                $('#action').append('<p>成功点击发送给朋友</p>')
              },
              complete:function(){
                $('#action').append('<p>完成发送给朋友</p>')
              },
              success: function () { 
                  // 用户确认分享后执行的回调函数
                  $('#action').append('<p>成功发送给朋友</p>')
              },
              cancel: function () { 
                  // 用户取消分享后执行的回调函数
                  $('#action').append('<p>取消发送给朋友</p>')
              }
          });



            wx.checkJsApi({
              jsApiList: ['chooseImage'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
              success: function(res) {
              //  alert(JSON.stringify(res))
                  // 以键值对的形式返回，可用的api值true，不可用为false
                  // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
              }});

        });
        wx.error(function(res){

            // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
          //  alert('wx.error config出错')
          //  alert(JSON.stringify(res))
        });

        

    }

  }






</script> 




























 






<div style="display:none;">
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F4d70084ab8a23d1e8e76861a9553677d' type='text/javascript'%3E%3C/script%3E"));
</script>
</div>

</body>


</html>